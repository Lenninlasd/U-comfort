<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		 <script src="/dist/confort.min.js"></script>
		<script>

		// Calculo de cargas comerciales de enfriamiento
		const datos = {
		    ubicacion: "Indianapolis, Ind",
		    latitud : 39,
			numero_personas: 60,
		    design: {
					perimetro: 300,
			        exterior: {
			              bulbo_seco: 90, // A.9 condiciones exteriores de diseño
			              bulbo_humedo: 74, // A.9
			              humedad_especifica: 101 // formula pendiente
			        },
		            recinto: {
		              // Estas condiciones no varian
		              bulbo_seco: 78,
		              humedad_relativa: 50,
		              humedad_especifica: 72
		          	}
		    }
  		};

		const carga_pico_enfriamiento = {
	      rango_diario : 22, // Fahrenheit
	      fecha: "21-07-xxxx",
	      hora: "17",
	      promedio: 79, // Fahrenheit
	  	};

		/* md`## Elementos del cuarto.
		Materiales en el cual se esta haciendo la conducción de exterior a interior.` */



		const vidrios = [
		  {
		    orientacion: "W",
		    coeficiente_transferencia_calor: 1.04,
		    area_neta: 830, //ft^2
			CLDT_tabla: 13, // ºF **
		  },{
		  	orientacion: "W",
		    coeficiente_transferencia_calor: 1.04,
		    area_neta: 42, //ft^2
			CLDT_tabla: 13, // ºF
		  },{
		    orientacion: "E",
		    coeficiente_transferencia_calor: 1.04,
		    area_neta: 42, //ft^2
			CLDT_tabla: 13, // ºF
		  }
	    ].map(getCLDT_correccion);

		const pared = [
		  {
		    orientacion: "N",
		    color: "D",
		    coeficiente_transferencia_calor: 0.13,
		    area_neta: 840, //ft^2
			CLDT_tabla: 11, // ºF
			correcion_latitud_mes_LM: 0,
			correcion_color_K: 1,
		  },{
		  	orientacion: "S",
		    color: "D",
		    coeficiente_transferencia_calor: 0.13,
		    area_neta: 840, //ft^2
			CLDT_tabla: 17, // ºF
			correcion_latitud_mes_LM: 1,
			correcion_color_K: 1,
		  },{
		    orientacion: "E",
		    color: "D",
		    coeficiente_transferencia_calor: 0.13,
		    area_bruta: 1260,
		    area_neta: 1176, //ft^2
			correcion_latitud_mes_LM: 0,
			correcion_color_K: 1,
			CLDT_tabla: 26, // ºF
		  },
		  {
		    orientacion: "W",
		    color: "D",
		    coeficiente_transferencia_calor: 0.13,
		    area_bruta: 1260,
		    area_neta: 388, //ft^2
			correcion_latitud_mes_LM: 0,
			correcion_color_K: 1,
			CLDT_tabla: 17, // ºF
		  }
	  ].map(getCLDT_correccion);

	const calor_vidrio = 1.04;
	const calor_pared = 0.13;
	const Factor_correcion_calor_sensible = getCalor_sensible(vidrios, pared, calor_vidrio, calor_pared); //0.91
	console.log('Factor_correcion_calor_sensible', Factor_correcion_calor_sensible);

	const  techo = getCLDT_correccion({
        color: "D",
        coeficiente_transferencia_calor: 0.09,
        area_neta: 5400, //ft^2
        CLDT_tabla: 71, // ºF
		correcion_latitud_mes_LM: 1,
		correcion_color_K: 1,
        CLDT_correccion: 66, // ºF
    });

	const piso = {
        coeficiente_transferencia_calor: 0.35,
        area_neta: 5400, //ft^2
        CLDT_correccion: datos.design.exterior.bulbo_seco - datos.design.recinto.bulbo_seco
	};

	const puerta = [
		{
		    orientacion: "E",
		    coeficiente_transferencia_calor: 0.18,
		    area_neta: 42, //ft^2
			CLDT_tabla: 27, // ºF
		    CLDT_correccion: 22, // ºF
		}
	];

	// Radiación solar a través de vidrio. (investigar)
	const radiacion_vidrio = [
	  {
	    direccion: "W",
	    sombra: "no",
	    SHGF: 216, //investigar
	    area: 830,
		SC: 0.69,
	    CLF: 0.56,
	  },
	    {
	    direccion: "W",
	    sombra: "no",
	    SHGF: 216, //investigar
	    area: 42,
		SC: 1,
	    CLF: 0.56,
	  },
	    {
	    direccion: "E",
	    sombra: "no",
	    SHGF: 216, //investigar
	    area: 42,
		SC: 1,
	    CLF: 0.23,
	  }
  	];

	// Otros calculos
	const luces = 16200 * 3.41 * 1.2 * 1.0 * 0.91; // RLHG BTU/h

	const personas = {
		sensible: 315 * datos.numero_personas * 1.0 * 0.91,
    	latente: 325 * datos.numero_personas
	}

	const ventilacion = {
		sensible: 1.1 * 600 * 12,
    	latente: 0.68 * 600 * 29
	}

	//Calculo final

	const ganancia_calor_recinto = calculoTotalSensible(vidrios, pared, techo, piso, puerta, radiacion_vidrio) + luces + personas.sensible;

	const ganancia_ventilador_forzado = ganancia_calor_recinto * 0.025;

	const total_sensible = ganancia_calor_recinto + ventilacion.sensible + ganancia_ventilador_forzado;

	const carga_enfriamiento = cargaEnfriamiento(total_sensible, personas, ventilacion); // Tons

	console.log(`# Carga de enfriamiento (tons): ${carga_enfriamiento}`);

	function cargaEnfriamiento(totalSensible, personas, ventilacion){
  		return (totalSensible + personas.latente + ventilacion.latente)/12000 // Tons
	}

	function calculoTotalSensible(vidrios = [{}], pared = [{}], techo = {}, piso = {}, puerta =[{}], radiacion_vidrio = [{}]){

	  	const calorVidrio = getCalorSensibleArray(vidrios);
	  	const calorPared = getCalorSensibleArray(pared);
	  	const calorTecho = getCalorSensible(techo);
	 	const calorPiso = 	getCalorSensible(piso);
	  	const calorPuerta = getCalorSensibleArray(puerta);
	  	const calorRadiacionVidrio = getCalorSensibleVidrio(radiacion_vidrio);

		return calorVidrio + calorPared + calorTecho + calorPiso + calorPuerta + calorRadiacionVidrio;


	    function getCalorSensibleVidrio(el){
	    	return el.map(i => i.SHGF * i.area * i.SC * i.CLF * Factor_correcion_calor_sensible)
	          .reduce( (anterior, actual) => {
	              return anterior + actual;
	          });
	    }

	    function getCalorSensibleArray(el){ // calculoIndividualSensible
	    	return el.map(i => getCalorSensible(i))
	          .reduce( (anterior, actual) => {
	              return anterior + actual;
	          });
	    }

	    function getCalorSensible(obj) {
	      return obj.coeficiente_transferencia_calor * obj.area_neta * obj.CLDT_correccion * Factor_correcion_calor_sensible;
	    }
	}

	// TODO: fn Calcular CLTD corregido

	function getCLDT_correccion(el) {
		// Note: investigar el CLDT_correccion de las puertas
		const DeltaTempDiseno = 78 - 85;
		const tempExterior = datos.design.exterior.bulbo_seco;
		const rango_diario = carga_pico_enfriamiento.rango_diario;
		const tempInterior = datos.design.recinto.bulbo_seco;
		const LM = el.correcion_latitud_mes_LM;
		const K = el.correcion_color_K;
		const CLDT_temp = LM !== undefined && K !== undefined ? (el.CLDT_tabla + LM) * K : el.CLDT_tabla;

		el.CLDT_correccion = CLDT_temp + DeltaTempDiseno + tempExterior - 0.5*rango_diario - tempInterior;
		return el;
	}

	function getCalor_sensible(vidrios, pared, transferencia_calor_vidrio, transferencia_calor_pared){
		const area_vidrio = vidrios.reduce( (a, b) => ({ area_neta: a.area_neta + b.area_neta }) ).area_neta;
		const area_pared = pared.reduce( (a, b) => ({ area_neta: a.area_neta + b.area_neta }) ).area_neta;
		const K_= (transferencia_calor_vidrio*area_vidrio + transferencia_calor_pared*area_pared) / datos.design.perimetro;
		return 1 - 0.02 * K_;
	}


		</script>
	</body>
</html>
